<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tijdregistratie</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Manifest & icons -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='64' height='64' rx='12' fill='%230ea5e9'/%3E%3Cpath d='M20 16h24v6H20zM16 26h16v6H16zM16 36h28v6H16z' fill='white'/%3E%3C/svg%3E" />

  <style>
    .dragging { opacity: .5 }
    .menu-shadow { box-shadow: 0 10px 30px rgba(0,0,0,.15) }
    .no-tap-highlight { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased select-none">

  <!-- App bar -->
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-lg bg-sky-500 grid place-items-center text-white font-bold">T</div>
        <h1 class="text-lg font-semibold">Tijdregistratie</h1>
        <span id="activeWarning" class="ml-3 text-xs font-medium px-2 py-1 rounded hidden"></span>
      </div>

      <div class="flex items-center gap-3">
        <button id="helpBtn" class="text-slate-600 hover:text-slate-900" title="Help">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 18h.01M9.09 9a3 3 0 015.83 1c0 2-3 2.5-3 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
        <button id="menuBtn" class="no-tap-highlight p-2 rounded hover:bg-slate-100" title="Menu">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Context menu -->
  <aside id="menu" class="hidden fixed right-4 top-14 bg-white menu-shadow rounded-lg border border-slate-200 w-56 z-40">
    <nav class="py-2">
      <button id="nav-register" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Registreren
      </button>
      <button id="nav-dashboard" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-sky-500"></span> Dashboard
      </button>
      <button id="nav-manage" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-violet-500"></span> Taakbeheer
      </button>
      <button id="nav-settings" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-amber-500"></span> Instellingen
      </button>
      <button id="nav-export" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-pink-500"></span> Export
      </button>
      <div class="h-px bg-slate-200 my-2"></div>
      <button id="nav-login" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-slate-400"></span> Login / Registreren
      </button>
      <button id="nav-logout" class="flex w-full items-center gap-3 px-3 py-2 hover:bg-slate-100">
        <span class="w-2 h-2 rounded-full bg-slate-400"></span> Uitloggen
      </button>
    </nav>
  </aside>

  <!-- Schermen -->
  <main class="max-w-5xl mx-auto p-4">
    <!-- Hoofdscherm -->
    <section id="screen-main">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-base font-semibold">Taken</h2>
        <div class="text-sm text-slate-500" id="userInfo">Niet ingelogd</div>
      </div>
      <ul id="taskList" class="space-y-2" aria-live="polite"></ul>
      <div id="emptyState" class="hidden text-center py-16 text-slate-500">Nog geen taken. Voeg er één toe met de “+”.</div>
      <button id="fabAdd" class="fixed right-4 bottom-20 md:bottom-8 w-14 h-14 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white text-3xl shadow-lg">+</button>
    </section>

    <!-- Dashboard -->
    <section id="panel-dashboard" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base font-semibold">Dashboard</h2>
        <button id="dashClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <div class="space-y-4" id="dashboardRoot"></div>
    </section>

    <!-- Taakbeheer -->
    <section id="panel-manage" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base font-semibold">Taakbeheer</h2>
        <button id="manageClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <ul id="manageList" class="space-y-2"></ul>
      <button id="fabAddManage" class="fixed right-4 bottom-20 md:bottom-8 w-14 h-14 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white text-3xl shadow-lg">+</button>
    </section>

    <!-- Instellingen -->
    <section id="panel-settings" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base font-semibold">Instellingen</h2>
        <button id="settingsClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <div class="grid gap-4 md:grid-cols-3">
        <label class="block">
          <span class="text-sm">Kleur >3 actieve taken</span>
          <input id="warn3" type="color" class="w-full h-10 border rounded" />
        </label>
        <label class="block">
          <span class="text-sm">Kleur >5 actieve taken</span>
          <input id="warn5" type="color" class="w-full h-10 border rounded" />
        </label>
        <label class="block">
          <span class="text-sm">Kleur >7 actieve taken</span>
          <input id="warn7" type="color" class="w-full h-10 border rounded" />
        </label>
      </div>
      <div class="mt-4">
        <button id="saveSettings" class="px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded">Opslaan</button>
      </div>
    </section>

    <!-- Export -->
    <section id="panel-export" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base font-semibold">Export</h2>
        <button id="exportClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <div class="space-y-3">
        <div class="grid gap-3 md:grid-cols-3">
          <label class="block">
            <span class="text-sm">Van (ISO)</span>
            <input id="expFrom" type="datetime-local" class="w-full border rounded px-2 h-10" />
          </label>
          <label class="block">
            <span class="text-sm">Tot (ISO)</span>
            <input id="expTo" type="datetime-local" class="w-full border rounded px-2 h-10" />
          </label>
        </div>
        <button id="btnExport" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded">Exporteer CSV</button>
        <a id="downloadLink" class="hidden text-sky-600 underline">Download CSV</a>
      </div>
    </section>

    <!-- Auth -->
    <section id="panel-auth" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base font-semibold">Login / Registreren</h2>
        <button id="authClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <form id="formLogin" class="space-y-3">
          <div class="font-medium">Inloggen</div>
          <input id="loginEmail" type="email" placeholder="E-mail" class="w-full border rounded px-2 h-10" required />
          <input id="loginPass" type="password" placeholder="Wachtwoord" class="w-full border rounded px-2 h-10" required />
          <button class="px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded" type="submit">Login</button>
          <button id="btnResetReq" type="button" class="px-3 py-2 text-slate-700 hover:text-slate-900">Wachtwoord vergeten?</button>
        </form>

        <form id="formRegister" class="space-y-3">
          <div class="font-medium">Registreren</div>
          <input id="regEmail" type="email" placeholder="E-mail" class="w-full border rounded px-2 h-10" required />
          <input id="regPass" type="password" placeholder="Wachtwoord (min 10 tekens)" class="w-full border rounded px-2 h-10" minlength="10" required />
          <button class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded" type="submit">Account maken</button>
        </form>
      </div>

      <div id="resetBox" class="hidden mt-6 space-y-3">
        <div class="font-medium">Wachtwoord resetten</div>
        <input id="resetToken" type="text" placeholder="Reset token (of via link)" class="w-full border rounded px-2 h-10" />
        <input id="resetPass" type="password" placeholder="Nieuw wachtwoord" class="w-full border rounded px-2 h-10" />
        <button id="btnResetDo" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded">Resetten</button>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modalTask" class="fixed inset-0 bg-black/40 hidden z-50">
    <div class="bg-white rounded-lg max-w-md mx-auto mt-20 p-4">
      <div class="flex items-center justify-between">
        <h3 id="modalTitle" class="text-base font-semibold">Taak</h3>
        <button id="modalClose" class="text-slate-500 hover:text-slate-900">✕</button>
      </div>
      <div class="mt-3 space-y-3">
        <input id="taskName" type="text" placeholder="Naam" class="w-full border rounded px-2 h-10" />
        <div class="grid md:grid-cols-2 gap-3">
          <label class="block">
            <span class="text-sm">Kleur</span>
            <input id="taskColor" type="color" class="w-full h-10 border rounded" />
          </label>
          <div class="flex items-end">
            <button id="btnSoftColor" class="px-3 py-2 border rounded w-full">Zachte kleur</button>
          </div>
        </div>
        <div class="grid md:grid-cols-2 gap-3">
          <label class="block">
            <span class="text-sm">Min aandacht (%)</span>
            <input id="taskMin" type="number" min="0" max="100" value="0" class="w-full border rounded px-2 h-10" />
          </label>
          <label class="block">
            <span class="text-sm">Max aandacht (%)</span>
            <input id="taskMax" type="number" min="1" max="100" value="100" class="w-full border rounded px-2 h-10" />
          </label>
        </div>
      </div>
      <div class="mt-4 flex justify-end gap-2">
        <button id="btnDeleteTask" class="hidden px-4 py-2 border rounded">Verwijderen</button>
        <button id="btnSaveTask" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded">Opslaan</button>
      </div>
    </div>
  </div>

  <!-- Help overlay -->
  <div id="helpOverlay" class="fixed inset-0 bg-black/60 hidden z-50">
    <div class="max-w-lg mx-auto mt-16 bg-white rounded-lg p-5 space-y-3">
      <div class="text-lg font-semibold">Welkom bij Tijdregistratie</div>
      <ol class="list-decimal list-inside text-slate-700 space-y-2">
        <li>Open het menu (drie stippen) en log in of maak een account aan.</li>
        <li>Voeg taken toe met de groene “+”. Start/stop per taak. Meerdere taken tegelijk kan.</li>
        <li>Sleep taken om de volgorde te veranderen (dit wordt bewaard).</li>
        <li>Aandacht wordt eerlijk verdeeld over actieve taken binnen min/max grenzen.</li>
        <li>Dashboard toont totalen en sessies. Exporteer data als CSV.</li>
        <li>Instellingen: waarschuwingkleuren voor >3, >5, >7 gelijktijdige taken.</li>
      </ol>
      <div class="text-right">
        <button id="helpClose" class="px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded">Aan de slag</button>
      </div>
    </div>
  </div>

  <script src="dashboard.js"></script>
  <script src="script.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
